# docker build . -t dessia/pyinstaller-windows
# https://github.com/cdrx/docker-pyinstaller/blob/master/Dockerfile-py3-win64
# https://askubuntu.com/questions/678277/how-to-install-python3-in-wine
# https://wiki.debian.org/Wine

FROM debian:bullseye

MAINTAINER Dessia Technologies "root@dessia.tech"

RUN apt update
RUN apt install -y wget gnupg software-properties-common apt-utils

# Need at least wine 4.14 to install python 3.10
RUN dpkg --add-architecture i386 \
    && add-apt-repository 'deb http://deb.debian.org/debian bullseye main contrib non-free' \
    && apt update
RUN apt install -y \
    wine \
    wine32 \
    wine64 \
    libwine \
    libwine:i386 \
    fonts-wine \
    winetricks \
    xvfb

# Add repo for faudio package.  Required for winedev
RUN add-apt-repository -y ppa:cybermax-dexter/sdl2-backport

# Dowloading Python 3.10.8
RUN wget https://www.python.org/ftp/python/3.10.8/python-3.10.8-amd64.exe

ENV WINEARCH win64
ENV WINEDEBUG fixme-all
ENV WINEPREFIX /wine64

RUN winetricks corefonts win10

COPY run.sh /run.sh
RUN chmod +x /run.sh
RUN /run.sh

RUN echo core dev exe lib path pip tcltk tools

COPY entrypoint.sh /entrypoint.sh

VOLUME /src/
WORKDIR /src

ENTRYPOINT ["/entrypoint.sh"]
